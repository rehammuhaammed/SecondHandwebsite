<app-header></app-header>

<div class="container">
  <aside class="chatList">
    <div class="search">                  
      <nav *ngIf="userData$ | async as userData">
        <label  class="user-label">USERS</label>               
        
          <ul class="slide" *ngIf="filteredUsers$ | async as filteredUsers">
            <li class="box" *ngFor="let user of filteredUsers" 
                (click)="startChat(user,userData[0].name)" [value]="user.uid">
              <p class="user-name">
                {{ user.name?.split(' ')?.slice(0,2)?.join(' ') }}
                <span *ngIf="user.hasNewMessage" class="new-message-indicator">NEW</span>
              </p>
            </li> 
          </ul>     
      </nav> 
    </div>
  </aside>

  <main class="messages" *ngIf="selectedUserId">  
    <div class="card">
      <div class="chat-header">{{ selectedUserName?.split(' ')?.slice(0,2)?.join(' ')  }}</div>
      <div class="chat-window">
        <ul class="message-list">
          <li *ngFor="let send of messages" class="message-item">{{send}}</li>
        </ul>
      </div>
      <div class="chat-input" *ngIf="userData$ | async as userData">
        <input 
          type="text" 
          class="message-input" 
          placeholder="Type your message here" 
          [(ngModel)]="newMessage"
          (keydown.enter)="sendMessage(userData[0].name)">
        <button class="send-button" (click)="sendMessage(userData[0].name)">Send</button>
      </div>
    </div>

    <div *ngIf="selectedUserName" class="selected-user">
      <img src="assets/picture.png" alt="User">
      <p>{{ selectedUserName?.split(' ')?.slice(0,2)?.join(' ') }}'s CHAT</p>
      
    </div>
  </main>
</div>